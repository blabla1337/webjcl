<!DOCTYPE html>
<html lang="en">
<head>
<title>WebJCL</title>
<style type="text/css" media="screen">
	
	body {
		margin:0;
	}
	
    #editor, #output { 
	
	float:left;
	height:90%;
    }
    
    #editor {
		
		width:35%;
		
	}
    
    #output {
		width:65%;
		margin-left:35%;
		float:right;
	}
    
    
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
</head>
<body>
<div style="width:100%;height:10%;">
	WebJCL proof of concept <input type="text" id="mar_username" value="mar_username"/><input type="password" id="mar_password" value="mar_password"/><button id="sub">Submit Job</button>
</div>
<div id="editor">
//KC03F57A JOB ,'WebJCL',MSGCLASS=H                           
//STEP1 EXEC PGM=ASSIST                                                 
//STEPLIB DD DSN=KC02293.ASSIST.LOADLIB,DISP=SHR                        
//SYSPRINT DD SYSOUT=*                                                  
//SYSIN DD *
*-------------------------------------------
* WebJCL Demo
*-------------------------------------------
*                           
MAIN CSECT                                                           
          USING MAIN,15
          L     4,=F'32'
          XDUMP
          BR    14
          END   MAIN                                                     
/*                                                                      
//   
</div>

<div id="output">
	Welcome to the prototype of WebJCL - this demonstrates a JCL JobProcessor 
	accessible via REST. This page POSTs the contents of the left pane to
	the /srcprocs/JESPrc/jobs resource. Lots of API documentation will 
	have to be revised in the next coming days.
	
	Output will show up here, but there is also some submission logging 
	in the browser console.
	
	Currently there are many things hard coded in the server in such like 
	username, password, and file names.
	
	
	Bug:  There is an asynchronous bug where sometimes sending the job fails (no such file or directory.)  
	This is because of some of the highly asynchronous nature of Node that I have been sloppy with.
	Just try it again.
	
	Client Implementation: Currently this thrown together webpage does not handle
	the case where the job takes too long while sumitting to Marist: it will fail (see console)
	and require a refresh.
</div>
    
<script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    var editor2 = ace.edit("output");
    //editor.setTheme("ace/theme/monokai");
    //editor.getSession().setMode("ace/mode/javascript");
    
    $("#sub").click(function()
    {
		$("#sub")[0].innerHTML = "Waiting for server response...";
		$("#sub")[0].disabled = true;
		
		$.ajax('./srcprocs/JESProc/jobs', 
		{	type: "POST",
			data: {action: "submit", files: [{path:"test.jcl", data: editor.getValue()}], "options": {"username": $("#mar_username")[0].value, "password": $("#mar_password")[0].value}},
			success: function(data, status, xhr)
			{
				console.log(data);
				console.log(data.output);
				editor2.setValue(data.files[0].data);
				
				$("#sub")[0].innerHTML = "Submit Job";
				$("#sub")[0].disabled = false;
				
			}
		})
			
		
	});
    
</script>
</body>
</html>
